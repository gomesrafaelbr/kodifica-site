<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Lista de Compras</title>
<style>
:root{
  --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb;
  --accent:#7c3aed; --danger:#ef4444; --border:#1f2937;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
  background:linear-gradient(180deg,#0b1220,#0a0f1a 60%);
  -webkit-text-size-adjust:100%;
}
header{
  position:sticky; top:0; z-index:10;
  padding:10px;
  padding-top:calc(10px + env(safe-area-inset-top));
  background:var(--bg); display:flex; justify-content:flex-end;
  border-bottom:1px solid var(--border);
}
.total-pill{
  display:flex; align-items:center; gap:10px; padding:10px 14px;
  border:1px solid var(--border); border-radius:12px; background:var(--card); font-weight:600;
}
main{max-width:1000px; margin:20px auto; padding:16px}
.card{
  background:var(--card); border:1px solid var(--border); border-radius:12px;
  padding:12px; margin-bottom:20px
}
.toolbar{
  display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-bottom:12px
}
.btn{
  padding:12px 14px; border-radius:10px; border:1px solid var(--border); cursor:pointer;
  background:#0b1220; color:var(--text); font-weight:600; line-height:1;
  min-height:44px; /* alvo de toque iOS */
  font-size:16px;  /* evita zoom no foco no iOS */
}
.btn.primary{background:var(--accent)}
.btn.danger{background:var(--danger)}
/* Desktop/Tablet default */
.grid-head,.row{
  display:grid; gap:8px; align-items:center;
  grid-template-columns:32px 1.4fr 90px 120px 120px 44px 44px;
}
.grid-head{font-weight:700; color:var(--muted); margin-bottom:8px}
.rows{display:flex; flex-direction:column; gap:8px}
.row{
  border:1px solid var(--border); padding:8px; border-radius:10px; background:#0a1324
}
.row input{
  width:100%; padding:10px; border-radius:8px; border:1px solid var(--border);
  background:var(--card); color:var(--text); font-size:16px;
}
.row .total{
  display:block; text-align:right; font-weight:700; padding:10px;
  border:1px solid var(--border); border-radius:8px; background:#0a162a
}
.row button{
  height:44px; border-radius:10px; border:1px solid var(--border);
  background:#0b1220; color:var(--text); cursor:pointer; font-size:16px
}
.summary{margin-top:10px; color:var(--muted)}
.io-actions{display:flex; gap:8px; margin-bottom:8px; flex-wrap:wrap}
textarea{
  width:100%; min-height:140px; background:var(--card); color:var(--text);
  border:1px solid var(--border); border-radius:10px; padding:10px; font-size:16px
}

/* ====== MOBILE (iPhone 13 ~390px) ====== */
@media (max-width: 640px){
  main{padding:12px}
  .grid-head{display:none}

  /* 3 colunas: [check] [coluna esquerda] [coluna direita] */
  .row{
    grid-template-columns:28px 1fr 1fr;
    grid-template-areas:
      "check name  name"
      "qty   price total"
      "add   remove total";
    gap:8px;
  }
  .row > :first-child{grid-area:check}
  .row .name{grid-area:name; min-width:0}
  .row .qty{grid-area:qty}
  .row .price{grid-area:price}
  .row .total{grid-area:total; align-self:stretch; display:flex; align-items:center; justify-content:flex-end}
  .row .add{grid-area:add}
  .row .remove{grid-area:remove}

  /* Ajuste visual de bot√µes na toolbar */
  .toolbar{gap:8px}
  .toolbar > div{display:flex; gap:8px; flex-wrap:wrap}
}

/* S√≥ aplica hover em quem tem hover (evita efeito ‚Äúgrudento‚Äù no mobile) */
@media (hover: hover){
  .btn:hover{filter:brightness(1.08)}
}
</style>
</head>
<body>
<header>
  <div class="total-pill" aria-live="polite">
    <small>Total Geral</small>
    <span id="grandTotal">R$ 0,00</span>
  </div>
</header>

<main>
  <section class="card">
    <div class="toolbar">
      <div>
        <button class="btn primary" id="addItem">+ Adicionar item</button>
        <button class="btn" id="addPreset">Sugest√£o r√°pida</button>
      </div>
      <div>
        <button class="btn danger" id="clearAll">Limpar tudo</button>
      </div>
    </div>

    <div class="grid-head">
      <div></div><div>Item</div><div>Qtd.</div><div>Pre√ßo (R$)</div><div>Total</div><div>+</div><div>üóë</div>
    </div>

    <div class="rows" id="rows"></div>
    <div class="summary" id="summary"></div>
  </section>

  <section class="card">
    <h2>Exporta√ß√£o / Importa√ß√£o (JSON)</h2>
    <div class="io-actions">
      <button class="btn" id="exportJson">Exportar JSON</button>
      <button class="btn" id="copyJson">Copiar JSON</button>
      <button class="btn" id="importJson">Importar JSON</button>
      <button class="btn danger" id="clearJson">Limpar JSON</button>
      <span class="status" id="ioStatus"></span>
    </div>
    <textarea id="jsonArea" placeholder='Cole JSON aqui ou clique em Exportar para ver os dados.'></textarea>
  </section>
</main>

<template id="rowTemplate">
  <div class="row">
    <div><input type="checkbox" class="done" aria-label="Concluir item"/></div>

    <!-- Dica: manter font-size 16px evita zoom no iOS -->
    <input type="text" class="name" placeholder="Ex: Caf√©" autocomplete="off" />

    <!-- Inteiro: teclado num√©rico -->
    <input type="number" class="qty" min="0" step="1" value="1"
           inputmode="numeric" pattern="[0-9]*" aria-label="Quantidade" />

    <!-- Decimal: teclado com v√≠rgula/ponto conforme o iOS -->
    <input type="number" class="price" min="0" step="0.01" value="0"
           inputmode="decimal" aria-label="Pre√ßo" />

    <span class="total" aria-label="Total do item">R$ 0,00</span>

    <button class="add" title="Adicionar novo item abaixo" aria-label="Adicionar novo item">‚ûï</button>
    <button class="remove" title="Remover item" aria-label="Remover item">üóë</button>
  </div>
</template>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const rowsEl = document.getElementById('rows');
  const summaryEl = document.getElementById('summary');
  const jsonArea = document.getElementById('jsonArea');
  const ioStatus = document.getElementById('ioStatus');
  const grandTotalEl = document.getElementById('grandTotal');
  const currency = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });

  // Helpers
  const parseNum = v => {
    const n = Number(v);
    return Number.isFinite(n) ? n : 0;
  };
  const rowToData = row => ({
    done: row.querySelector('.done').checked,
    name: row.querySelector('.name').value.trim(),
    qty: parseNum(row.querySelector('.qty').value),
    price: parseNum(row.querySelector('.price').value)
  });

  function dataToRow(data){
    const node = document.getElementById('rowTemplate').content.firstElementChild.cloneNode(true);
    const done = node.querySelector('.done');
    const name = node.querySelector('.name');
    const qty = node.querySelector('.qty');
    const price = node.querySelector('.price');
    const total = node.querySelector('.total');
    const addBtn = node.querySelector('.add');
    const removeBtn = node.querySelector('.remove');

    done.checked = !!data.done;
    name.value = data.name ?? '';
    qty.value = data.qty ?? 1;
    price.value = data.price ?? 0;

    const updateState = () => {
      total.textContent = currency.format(parseNum(qty.value) * parseNum(price.value));
      node.classList.toggle('done', done.checked);
      updateGrandTotal();
      updateSummary();
    };

    // Evita valores negativos via roda do n√∫mero (mobile raramente, mas desktop sim)
    qty.addEventListener('input', () => { if (parseNum(qty.value) < 0) qty.value = 0; updateState(); });
    price.addEventListener('input', () => { if (parseNum(price.value) < 0) price.value = 0; updateState(); });

    done.addEventListener('change', updateState);
    name.addEventListener('input', updateSummary);

    removeBtn.addEventListener('click', () => { node.remove(); updateGrandTotal(); updateSummary(); });
    addBtn.addEventListener('click', () => { addRow(); });

    updateState();
    return node;
  }

  function addRow(data={done:false,name:'',qty:1,price:0}){
    rowsEl.appendChild(dataToRow(data));
  }
  const getAllRows = () => Array.from(rowsEl.querySelectorAll('.row'));

  function updateGrandTotal(){
    const sum = getAllRows().reduce((acc, r) => {
      const d = rowToData(r);
      return acc + (d.qty * d.price);
    }, 0);
    grandTotalEl.textContent = currency.format(sum);
  }
  function updateSummary(){
    const items = getAllRows().map(rowToData);
    const count = items.length, done = items.filter(i=>i.done).length, pend = count - done;
    summaryEl.textContent = `${count} item(s) ‚Ä¢ ${pend} pendente(s) ‚Ä¢ ${done} conclu√≠do(s)`;
  }

  // JSON
  function setStatus(msg){
    if(!ioStatus) return;
    ioStatus.textContent = msg;
    setTimeout(()=> ioStatus.textContent = '', 2000);
  }
  function exportJSON(){
    jsonArea.value = JSON.stringify(getAllRows().map(rowToData), null, 2);
    setStatus('Exportado');
  }
  async function copyJSON(){
    if(!jsonArea.value) exportJSON();
    try{
      await navigator.clipboard.writeText(jsonArea.value);
      setStatus('Copiado');
    }catch(e){
      jsonArea.select(); document.execCommand('copy');
      setStatus('Selecionado para copiar');
    }
  }
  function importJSON(){
    try{
      const arr = JSON.parse(jsonArea.value);
      if(!Array.isArray(arr)) throw 0;
      rowsEl.replaceChildren();
      arr.forEach(d => addRow(d));
      updateGrandTotal(); updateSummary();
      setStatus('Importado');
    }catch(e){ setStatus('JSON inv√°lido'); }
  }
  function clearJSON(){ jsonArea.value=''; setStatus('JSON limpo'); }

  // Bot√µes topo
  document.getElementById('addItem').onclick = () => addRow();
  document.getElementById('addPreset').onclick = () => {
    const preset = [
      {name:'Arroz 5kg',qty:1,price:24.9},
      {name:'Feij√£o',qty:2,price:7.49},
      {name:'Leite (sem lactose)',qty:6,price:4.99},
      {name:'Caf√©',qty:1,price:16.50},
    ];
    preset.forEach(addRow);
    updateGrandTotal(); updateSummary();
  };
  document.getElementById('clearAll').onclick = () => {
    rowsEl.replaceChildren();
    updateGrandTotal(); updateSummary();
  };

  // Bot√µes JSON
  document.getElementById('exportJson').onclick = exportJSON;
  document.getElementById('copyJson').onclick = copyJSON;
  document.getElementById('importJson').onclick = importJSON;
  document.getElementById('clearJson').onclick = clearJSON;

  // Start
  addRow();
  updateGrandTotal();
  updateSummary();
});
</script>
</body>
</html>
